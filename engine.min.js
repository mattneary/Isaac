keyCodes={up:"&",left:"%",right:"'",down:"("};var kkeys={},isDown=function(a){return kkeys[a]},handleKeyPresses=function(){window.onkeydown=function(a){kkeys[String.fromCharCode(a.keyCode)]=!0;return!1};window.onkeyup=function(a){kkeys[String.fromCharCode(a.keyCode)]=!1}};Object.prototype.extend=function(){var a=Array.prototype.slice.call(arguments),b;for(b in a){var c="function"!=typeof arguments[b]?arguments[b]:{};for(b in c)this[b]=0!=b&&this[b]?this[b]:c[b]}};
var Scene=function(a,b){b=b||{};a.sceneSpeed=b.speed||{x:function(){return 0},y:function(){return 0}};this.go=function(b){var d=0,e;handleKeyPresses();e=setInterval(function(){ctx.clearRect(0,0,1E3,1E3);a.move(d);a.draw(d);d++},30);b&&b(e)}},Rect=function(a){this.extend(a,{width:a.size,height:a.size,color:"#000"})},Character=function(a,b){this.extend(a,{shapes:[],title:"",speed:{x:Function("return 0"),y:Function("return 0")},collisions:{},offset:{x:0,y:0}});!1!==b&&(characters[a.title]=this)};
Character.prototype={shade:function(){var a=this.text?this.text():"",b=this.shapes,c=this.offset,d;for(d in b){var e=b[d];ctx.fillStyle=e.color;ctx.fillRect(e.x+c.x,cvs.height-(e.y+c.y),e.width,e.height);ctx.font="italic 30px sans-serif";ctx.textBaseline="top";a&&ctx.fillText(a,e.x+c.x,cvs.height-(e.y+c.y))}},move:function(a,b,c){var d;this.jumpStartTime&&(d=a-this.jumpStartTime*b);var b=this.speed.x.call(this,a),e=this.speed.y.call(this,a),e=d?e-d:a==this.jumpStartTime?e:0;this.fixed?(this.offset.x+=
this.speed.x.call(this,a),this.offset.y+=this.speed.y.call(this,a)):(this.offset.x+=b,this.offset.y+=e,this.offset.x-=c.x(a),this.offset.y-=c.y(a))},jumpStartTime:null,endJump:function(){this.jumpStartTime=null},startJump:function(a,b){this.jumpStartTime=a;return this.jumpForce=b},currentVelocity:function(){return this.jumpStartTime?this.jumpForce:0},isOccupied:function(a,b){for(var c in this.shapes){var d=this.shapes[c],e=a,f=b;if(e>=this.offset.x+d.x-0&&e<=this.offset.x+d.x+d.width+0&&f<=this.offset.y+
d.y-0&&f>=this.offset.y+d.y-d.height+0)return!0}return!1},overlaps:function(a){for(var b in this.shapes)if(a&&a.shapes){var c=a.shapes[b],d=a.offset;if(this.isOccupied(d.x+c.x,d.y+c.y)||this.isOccupied(d.x+c.x+(c.width||c.size),d.y+c.y)||this.isOccupied(d.x+c.x,d.y+(c.height||c.size))||this.isOccupied(d.x+c.x+(c.width||c.size),d.y+c.y+(c.height||c.size)))return!0}return!1},kill:function(){delete characters[this.title]},revive:function(){characters[this.title]=this}};var CharacterList=function(a){this.extend(a)};
CharacterList.prototype.extend(Array.prototype,{move:function(a){for(var b in this){(character=this[b])&&character.move&&character.move(a,this.gravity,this.sceneSpeed);var c=character.collisions;for(b in c)if("extend"!=b){var d=c[b];this[b].overlaps&&(character.overlaps(this[b])||this[b].overlaps(character))&&d()}}},draw:function(a){for(var b in this)(character=this[b])&&character.shade&&character.shade(a)},gravity:1});
