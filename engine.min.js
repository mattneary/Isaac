keyCodes={up:"&",left:"%",right:"'",down:"("};var kkeys={},isDown=function(a){return kkeys[a]},handleKeyPresses=function(){window.onkeydown=function(a){kkeys[String.fromCharCode(a.keyCode)]=!0;return!1};window.onkeyup=function(a){kkeys[String.fromCharCode(a.keyCode)]=!1}};Object.prototype.extend=function(){var a=Array.prototype.slice.call(arguments),c;for(c in a){var b="function"!=typeof arguments[c]?arguments[c]:{};console.log(b);for(c in b)this[c]=b[c]}};
var go=function(a,c){var b=0;handleKeyPresses();inter=setInterval(function(){ctx.clearRect(0,0,1E3,1E3);a.move(b);a.draw(b);b++},30);c&&c()},Rect=function(a){var c=a.color||"#000",b=a.y,d=a.width,e=a.height,f=a.size;this.x=a.x;this.y=b;this.color=c;this.width=d||f;this.height=e||f},Character=function(a,c){shapes=a.shapes||[];title=a.title||"";speeds=a.speeds||{x:Function("return 0"),y:Function("return 0")};collisions=a.collisions||{};this.title=title;this.shapes=shapes;this.speed={x:speeds.x,y:speeds.y};
this.offset={x:0,y:0};this.collisions=collisions;this.text=a.text;!1!==c&&(characters[title]=this)};
Character.prototype={shade:function(){var a=this.text?this.text():"",c=this.shapes,b=this.offset,d;for(d in c){var e=c[d];e.width=e.width||e.size;e.height=e.height||e.size;b=b||{x:0,y:0};ctx.fillStyle=e.color;ctx.fillRect(e.x+b.x,height-(e.y+b.y),e.width,e.height);ctx.font="italic 30px sans-serif";ctx.textBaseline="top";a&&ctx.fillText(a,e.x+b.x,height-(e.y+b.y))}},move:function(a,c){var b;this.gravityStart&&(b=a-this.gravityStart*c);var d=this.speed.x.call(this,a),e=this.speed.y.call(this,a),e=b?
e-b:a==this.gravityStart?e:0;this.fixed?(console.log("FIXED"),this.offset.x+=this.speed.x.call(this,a),this.offset.y+=this.speed.y.call(this,a)):(this.offset.x+=d,this.offset.y+=e)},gravityStart:null,gravityReset:function(){this.gravityStart=null},isOccupied:function(a,c){for(var b in this.shapes){var d=this.shapes[b],e=a,f=c;if(e>=this.offset.x+d.x-0&&e<=this.offset.x+d.x+d.width+0&&f<=this.offset.y+d.y-0&&f>=this.offset.y+d.y-d.height+0)return!0}return!1},overlaps:function(a){for(var c in this.shapes)if(a&&
a.shapes){var b=a.shapes[c],d=a.offset;if(this.isOccupied(d.x+b.x,d.y+b.y)||this.isOccupied(d.x+b.x+(b.width||b.size),d.y+b.y)||this.isOccupied(d.x+b.x,d.y+(b.height||b.size))||this.isOccupied(d.x+b.x+(b.width||b.size),d.y+b.y+(b.height||b.size)))return!0}return!1},kill:function(){delete characters[this.title]},revive:function(){characters[this.title]=this}};var CharacterList=function(a){for(var c in a)this[c]=a[c]};
CharacterList.prototype.extend(Array.prototype,{move:function(a){for(var c in this){(character=this[c])&&character.move&&character.move(a,this.gravity);var b=character.collisions;for(c in b)if("extend"!=c){var d=b[c];this[c].overlaps&&(character.overlaps(this[c])||this[c].overlaps(character))&&d()}}},draw:function(a){for(var c in this)(character=this[c])&&character.shade&&character.shade(a)},gravity:1});
