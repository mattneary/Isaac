<html>
	<head>
		<title>Graphics Engine</title>
		<script src="engine.js"></script>
	</head>
	<body>
		<canvas id="cvs"></canvas>
		<script>	
			var int			/*Animation Interval*/,
				cvs 		= document.getElementById('cvs'),
				ctx 		= cvs.getContext('2d'),
				characters 	= new CharacterList({}),
				width 		= height = 500;
			cvs.width 		= width,
			cvs.height 		= height,
			score			= 0,			
			//Character with empty shape and text function to show score
			scoreboard		= new Character({
				shapes: [new Rect({
							x: 0,
							y: 500,
							width: 0,
							height: 50,
							color: '#cfcceb'
						})], 
				text: function() {
					return "Score: "+score;
				},
				title: "score_board"	//Used for collisions but also used internally
			});			
									
			//Score-board
			var incrementScore = function() {
				score++;
			};
											
			//Instances of characters	
			var person = new Character({
				shapes: [new Rect({
							x: 35,
							y: 55,
							size: 25
						})], 
				title: "person", 
				speeds: {
					x: function(t) {																						
						if( isDown(keyCodes.left) ) return -5;
						if( isDown(keyCodes.right) ) return 5;
						return 0;
					},
					y: function(t) {
						if( isDown(keyCodes.down) ) return -5;
						if( isDown(keyCodes.up) ) {
							this.gravityStart = t;
							return 10;
						}
						return this.gravityStart?10:0;	//If falling, upward force is same as when jump begins
					}					
				}, 
				collisions: {
					apple: function() {
						apple.kill();
						Apple().revive();
						incrementScore();
					},
					ground: function() {						
						person.gravityReset();
					}				
				}
			});		
			
			//Apple constructor		
			var Apple = function() {
				return new Character({
					shapes: [new Rect({
								x: Math.random()*300,
								y: Math.random()*300,
								size: 10,
								color: "#f00"
							})], 
					title: "apple"
				});	
			};
			var apple = Apple();		//This assignment will be used repeatedly when "reviving" and when "killing"
										//In general, characters should be leaked to the global scope in order to allow
										//intuitive usage of their attributes
			
			var ground = new Character({
				shapes: [new Rect({
							x: 0,
							y: 20,
							width: 500,
							height: 20,
							color: "#f00"
						})], 
				title: "ground"
			});												
			
			//GO!
			go(characters, function() {
				setTimeout(function() {
					//Limit time to 15 secs until animation is cancelled
					clearInterval(int);
					(new Character({
						shapes: [new Rect({
									x: 100,
									y: 300,
									width: 0,
									height: 50,
									color: '#f00'
								})], 
						text: function() {
							return "Game Over (Score: "+score+")";
						}
					})).shade();
				}, 15e3);
			});
		</script>
	</body>
</html>